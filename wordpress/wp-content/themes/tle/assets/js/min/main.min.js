
jQuery(document).ready(function($) {

	$("#clients-pc").bxSlider({
      nextSelector: '#nextpc',
      prevSelector: '#backpc',
      pager: false,
      hideControlOnEnd: false
    });
	 
   $("#clients-sm").bxSlider({
      nextSelector: '#nextsm',
      prevSelector: '#backsm',
      pager: false,
      hideControlOnEnd: false
    });
  doc_height = jQuery(window).height();
  header_height = $("#masthead").height();
  footer_height =  $(".site-footer").height();
  $("#content").css("min-height",doc_height-header_height-footer_height-20);

// function  get_height_img(urlimg){
//   var tmpImg = new Image();
//   var orgWidth = 0;
//   var orgHeight = 0;
//   tmpImg.src=urlimg;
//   return tmpImg;
// }

  var Page = (function() {
        var list_img = $("#bb-bookblock").find("img");
        var max_width = 0;
        var max_height = 0;
        var entry_width = $(".entry-content").width()*0.8;
        for (var i = 0; i < list_img.length; i++) {
          img_tmp = list_img[i];
          tmpImg = new Image();
          tmpImg.src = $(img_tmp).attr('src');
          if( tmpImg.height > max_height) {
            max_height = tmpImg.height;
          }
          if( tmpImg.width > max_width) {
            max_width = tmpImg.width;
          }          
        };

        var d = entry_width/max_width;
        if(d<1){
          max_height = d*max_height;
          max_width = d*max_width;
        }

        // if( new_width > max_width) {
        //   max_width = entry_width*d;
        // }
        $("#bb-bookblock").css({
          width: max_width,
          height: max_height
        });
        var config = {
            $bookBlock : $( '#bb-bookblock' ),
            $navNext : $( '#bb-nav-next' ),
            $navPrev : $( '#bb-nav-prev' ),
            $navFirst : $( '#bb-nav-first' ),
            $navLast : $( '#bb-nav-last' )
          },
          init = function() {
            config.$bookBlock.bookblock( {
              speed : 800,
              shadowSides : 0.8,
              shadowFlip : 0.7
            } );
            initEvents();
          },
          initEvents = function() {
            
            var $slides = config.$bookBlock.children();

            // add navigation events
            config.$navNext.on( 'click touchstart', function() {
              config.$bookBlock.bookblock( 'next' );
              return false;
            } );

            config.$navPrev.on( 'click touchstart', function() {
              config.$bookBlock.bookblock( 'prev' );
              return false;
            } );

            config.$navFirst.on( 'click touchstart', function() {
              config.$bookBlock.bookblock( 'first' );
              return false;
            } );

            config.$navLast.on( 'click touchstart', function() {
              config.$bookBlock.bookblock( 'last' );
              return false;
            } );
            
            // add swipe events
            $slides.on( {
              'swipeleft' : function( event ) {
                config.$bookBlock.bookblock( 'next' );
                return false;
              },
              'swiperight' : function( event ) {
                config.$bookBlock.bookblock( 'prev' );
                return false;
              }
            } );

            // add keyboard events
            $( document ).keydown( function(e) {
              var keyCode = e.keyCode || e.which,
                arrow = {
                  left : 37,
                  up : 38,
                  right : 39,
                  down : 40
                };

              switch (keyCode) {
                case arrow.left:
                  config.$bookBlock.bookblock( 'prev' );
                  break;
                case arrow.right:
                  config.$bookBlock.bookblock( 'next' );
                  break;
              }
            } );
          };

          return { init : init };

      })();
      Page.init();
});